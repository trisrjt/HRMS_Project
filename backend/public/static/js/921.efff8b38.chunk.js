"use strict";(self.webpackChunkfrontend_react=self.webpackChunkfrontend_react||[]).push([[921],{5921:(e,t,r)=>{r.r(t),r.d(t,{default:()=>w});var a=r(9379),s=r(5043),d=r(1321),n=r(1291),o=r(9419),l=r(6036),i=r(3318),c=r(2023),x=(r(6433),r(228)),g=r.n(x),u=r(4004),h=r(8729),m=r(579);delete g().Icon.Default.prototype._getIconUrl,g().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const b=e=>{let{children:t,className:r}=e;return(0,m.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 transition-colors duration-200 ".concat(r),children:t})},y=e=>{let{children:t}=e;return(0,m.jsx)("div",{className:"p-6 border-b border-gray-100 dark:border-gray-700",children:t})},k=e=>{let{children:t,className:r}=e;return(0,m.jsx)("div",{className:"p-6 ".concat(r),children:t})},p=e=>{let{children:t}=e;return(0,m.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white m-0",children:t})},v=e=>{let{children:t,onClick:r,disabled:a,variant:s="primary",className:d}=e;return(0,m.jsx)("button",{onClick:r,disabled:a,className:"px-5 py-2.5 rounded-lg font-medium text-sm transition-all duration-200 flex items-center justify-center ".concat({primary:"bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg disabled:bg-blue-300 disabled:shadow-none",success:"bg-emerald-600 hover:bg-emerald-700 text-white shadow-md hover:shadow-lg disabled:bg-emerald-300 disabled:shadow-none",outline:"bg-transparent border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",destructive:"bg-red-600 hover:bg-red-700 text-white shadow-md hover:shadow-lg disabled:bg-red-300 disabled:shadow-none"}[s]," ").concat(a?"cursor-not-allowed":"cursor-pointer"," ").concat(d),children:t})},f=e=>{let{children:t,variant:r="error"}=e;return(0,m.jsx)("div",{className:"p-4 rounded-lg mb-4 text-sm border ".concat("error"===r?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-700 dark:text-red-400":"bg-emerald-50 dark:bg-emerald-900/20 border-emerald-200 dark:border-emerald-800 text-emerald-700 dark:text-emerald-400"),children:t})},j=e=>{let{children:t,variant:r="default"}=e;const a={default:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",success:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400",danger:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",warning:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400",Present:"bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400",Absent:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400",Late:"bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-400","Half Day":"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400"},s=a[r]||a.default;return(0,m.jsx)("span",{className:"inline-flex px-2.5 py-1 rounded-full text-xs font-semibold ".concat(s),children:t})},w=()=>{const{user:e,refreshUser:t}=(0,h.A)(),[r,x]=(0,s.useState)([]),[g,w]=(0,s.useState)(!0),[N,_]=(0,s.useState)(null),[S,C]=(0,s.useState)(null),[O,A]=(0,s.useState)(null),[F,I]=(0,s.useState)(!1),[P,L]=(0,s.useState)(!1),[D,E]=(0,s.useState)(null),[T,U]=(0,s.useState)(!1),[q,M]=(0,s.useState)(null),[R,H]=(0,s.useState)(!1),[W,G]=(0,s.useState)([]),[Y,z]=(0,s.useState)(!1),[B,V]=(0,s.useState)(!1),[J,K]=(0,s.useState)(!1),[Z,Q]=(0,s.useState)(!1),X="undefined"!==typeof window&&window.isSecureContext,[$,ee]=(0,s.useState)((new Date).toISOString().slice(0,7)),te=async()=>{try{_(null);const e=await d.A.get("/my-attendance"),t=e.data.data||e.data;x(Array.isArray(t)?t:[])}catch(e){console.error("Fetch error:",e),_("Failed to load attendance records. Please try again later.")}finally{w(!1)}};(0,s.useEffect)(()=>{te()},[]),(0,s.useEffect)(()=>{if(O||S){const e=setTimeout(()=>{A(null),C(null)},3e3);return()=>clearTimeout(e)}},[O,S]),(0,s.useEffect)(()=>(document.body.style.overflow=T?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[T]);const re=()=>new Promise((e,t)=>{var r;if(X){if(console.log("\ud83d\udd0d Checking geolocation support..."),!navigator.geolocation)return console.error("\u274c Geolocation not supported"),void t(new Error("Geolocation is not supported by your browser. Please use a modern browser to check in."));console.log("\u2705 Geolocation supported, requesting permission..."),null!==(r=navigator.permissions)&&void 0!==r&&r.query&&navigator.permissions.query({name:"geolocation"}).then(e=>{console.log("\ud83e\udded Geolocation permission state:",e.state)}).catch(e=>{console.log("\ud83e\udded Geolocation permission query failed:",e)}),navigator.geolocation.getCurrentPosition(t=>{console.log("\u2705 Location obtained:",t.coords);const r={latitude:t.coords.latitude,longitude:t.coords.longitude};E(r),e(r)},e=>{console.error("\u274c Location error:",e.code,e.message);let r="Location access denied. Please allow location access to check in.";e.code===e.PERMISSION_DENIED?r="Location permission denied. You must allow location access to check in/out.":e.code===e.POSITION_UNAVAILABLE?r="Location information unavailable. Please try again.":e.code===e.TIMEOUT&&(r="Location request timed out. Please try again."),t(new Error(r))},{timeout:15e3,enableHighAccuracy:!0,maximumAge:0})}else t(new Error("Location requires a secure context. Open the app on http://localhost:3000 (or use HTTPS)."))}),ae=()=>{const e=navigator.userAgent;let t="Desktop";/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?t="Tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)&&(t="Mobile");let r="Unknown";e.indexOf("Firefox")>-1?r="Firefox":e.indexOf("Chrome")>-1?r="Chrome":e.indexOf("Safari")>-1?r="Safari":e.indexOf("Edge")>-1?r="Edge":(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)&&(r="IE");let a=localStorage.getItem("device_id");return a||(a="device_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("device_id",a)),{device_id:a,device_type:t,browser:r}},se=async()=>{console.log("\ud83d\udd35 Check-in button clicked");const t=(new Date).toISOString().split("T")[0],s=r.find(e=>new Date(e.date).toISOString().split("T")[0]===t);if(null!==s&&void 0!==s&&s.check_in)C("You have already checked in today.");else{if(null===e||void 0===e||!e.face_descriptor){console.log("\u26a0\ufe0f Face enrollment required for first check-in");return window.confirm("Face enrollment is required for attendance tracking. Would you like to enroll your face now?")?(Q(!0),void K(!0)):void C("Face enrollment is required to check in.")}try{M("check-in"),C(null),console.log("\ud83d\udccd Requesting location for check-in...");const e=await re();console.log("\u2705 Location received:",e);const t=await d.A.post("/my-attendance/check-in",(0,a.A)({latitude:e.latitude,longitude:e.longitude},ae()));if(t.data.requires_action&&t.data.pending_checkouts)return console.log("\u26a0\ufe0f Pending checkouts detected:",t.data.pending_checkouts),G(t.data.pending_checkouts),H(!0),void E(e);U(!0)}catch(i){var n,o,l;if(console.error("\u274c Check-in error:",i),409===(null===i||void 0===i||null===(n=i.response)||void 0===n?void 0:n.status))C((null===i||void 0===i||null===(o=i.response)||void 0===o||null===(l=o.data)||void 0===l?void 0:l.message)||"Already checked in today.");else C((null===i||void 0===i?void 0:i.message)||"Location access denied. In Brave: click the icon near the URL \u2192 Site settings \u2192 Location \u2192 Allow");M(null)}}},de=(new Date).toISOString().split("T")[0],ne=r.find(e=>new Date(e.date).toISOString().split("T")[0]===de),oe=!(null===ne||void 0===ne||!ne.check_in),le=!(null===ne||void 0===ne||!ne.check_out),ie=!(null===ne||void 0===ne||!ne.overtime_start),ce=!(null===ne||void 0===ne||!ne.overtime_end),xe=(0,n.xN)(r),ge=(0,n.P2)(r,$),ue=r.filter(e=>e.date.startsWith($));return g?(0,m.jsx)("div",{className:"flex justify-center items-center h-screen bg-gray-50 dark:bg-gray-900 text-gray-500 dark:text-gray-400 transition-colors",children:(0,m.jsx)("div",{className:"text-xl font-medium animate-pulse",children:"Loading attendance..."})}):(0,m.jsxs)("div",{className:"p-6 max-w-[1200px] mx-auto bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-200",children:[(0,m.jsxs)("div",{className:"flex flex-col gap-6 mb-8",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center flex-wrap gap-4",children:[(0,m.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"My Attendance"}),(0,m.jsxs)("div",{className:"flex gap-4 flex-wrap",children:[(0,m.jsx)(v,{onClick:se,disabled:F||oe,variant:"success",children:F?"Checking In...":oe?"Checked In":"Check In"}),(0,m.jsx)(v,{onClick:async()=>{console.log("\ud83d\udd34 Check-out button clicked"),C(null),console.log("\ud83d\udd34 Getting location for check-out...");try{const e=await re();console.log("\u2705 Location obtained:",e),E(e),M("check-out"),U(!0)}catch(N){console.error("\u274c Location error:",N),C(N.message||"Failed to get your location. Please enable location services.")}},disabled:P||!oe||le,variant:"destructive",children:P?"Checking Out...":le?"Checked Out":"Check Out"}),le&&!ce&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(v,{onClick:async()=>{try{z(!0),C(null),await d.A.post("/my-attendance/overtime/start"),A("Overtime started successfully!"),await te()}catch(r){var e,t;console.error("Start overtime error:",r),C((null===r||void 0===r||null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to start overtime. Please try again.")}finally{z(!1)}},disabled:Y||ie,variant:"primary",className:"bg-purple-600 hover:bg-purple-700",children:Y?"Starting...":ie?"OT Started":"Start Overtime"}),ie&&(0,m.jsx)(v,{onClick:async()=>{try{V(!0),C(null),await d.A.post("/my-attendance/overtime/end"),A("Overtime ended successfully!"),await te()}catch(r){var e,t;console.error("End overtime error:",r),C((null===r||void 0===r||null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to end overtime. Please try again.")}finally{V(!1)}},disabled:B,variant:"primary",className:"bg-orange-600 hover:bg-orange-700",children:B?"Ending...":"End Overtime"})]})]})]}),S&&(0,m.jsxs)(f,{variant:"error",children:[(0,m.jsx)("strong",{children:"Error:"})," ",S]}),O&&(0,m.jsxs)(f,{variant:"success",children:[(0,m.jsx)("strong",{children:"Success:"})," ",O]}),N&&(0,m.jsx)(f,{variant:"error",children:N})]}),(0,m.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,m.jsxs)("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm transition-colors duration-200",children:[(0,m.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2 font-medium uppercase tracking-wide",children:"This Week"}),(0,m.jsxs)("div",{className:"flex items-baseline gap-2 mb-4",children:[(0,m.jsx)("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:xe.formatted||"0h 0m"}),(0,m.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"worked"})]}),(0,m.jsxs)("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 border-t border-gray-100 dark:border-gray-700 pt-4",children:[(0,m.jsxs)("span",{children:["Days: ",(0,m.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:xe.daysWorked||0})]}),(0,m.jsxs)("span",{children:["Avg: ",(0,m.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:xe.average||"0h"})," / day"]})]})]}),(0,m.jsxs)("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm transition-colors duration-200",children:[(0,m.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,m.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 font-medium uppercase tracking-wide",children:"Monthly Overview"}),(0,m.jsx)("input",{type:"month",id:"month-filter",name:"month-filter",value:$,onChange:e=>ee(e.target.value),className:"bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-200 text-sm px-3 py-1 rounded border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,m.jsxs)("div",{className:"flex items-baseline gap-2 mb-4",children:[(0,m.jsx)("span",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:ge.formatted||"0h 0m"}),(0,m.jsx)("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"worked"})]}),(0,m.jsxs)("div",{className:"flex justify-between text-sm text-gray-500 dark:text-gray-400 border-t border-gray-100 dark:border-gray-700 pt-4",children:[(0,m.jsxs)("span",{children:["Days: ",(0,m.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:ge.daysWorked||0})]}),(0,m.jsxs)("span",{children:["Avg: ",(0,m.jsx)("strong",{className:"text-gray-700 dark:text-gray-300",children:ge.average||"0h"})," / day"]})]})]})]}),(0,m.jsxs)(b,{className:"overflow-hidden",children:[(0,m.jsx)(y,{children:(0,m.jsxs)(p,{children:["Attendance History (",new Date($+"-01").toLocaleString("default",{month:"long",year:"numeric"}),")"]})}),(0,m.jsx)(k,{className:"p-0",children:(0,m.jsx)("div",{className:"overflow-x-auto",children:(0,m.jsxs)("table",{className:"w-full text-left border-collapse",children:[(0,m.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-700/50",children:(0,m.jsxs)("tr",{children:[(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Date"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Check In"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Check Out"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Hours"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Overtime"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Location"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Device"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),(0,m.jsx)("th",{className:"p-4 border-b border-gray-200 dark:border-gray-700 text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Remarks"})]})}),(0,m.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:ue.length>0?ue.map(e=>(0,m.jsxs)("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[(0,m.jsx)("td",{className:"p-4 text-sm font-medium text-gray-900 dark:text-white",children:new Date(e.date).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),(0,m.jsx)("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:(0,m.jsxs)("div",{className:"flex flex-col",children:[(0,m.jsx)("span",{children:e.check_in?(0,n.fU)(e.check_in,e.date):"--:--"}),e.check_in_latitude&&e.check_in_longitude&&(0,m.jsx)("a",{href:"https://www.google.com/maps?q=".concat(e.check_in_latitude,",").concat(e.check_in_longitude),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline mt-1",onClick:e=>e.stopPropagation(),children:"\ud83d\udccd View"})]})}),(0,m.jsx)("td",{className:"p-4 text-sm text-gray-700 dark:text-gray-300",children:(0,m.jsxs)("div",{className:"flex flex-col",children:[(0,m.jsx)("span",{children:e.check_out?(0,n.fU)(e.check_out,e.date):"--:--"}),e.check_out_latitude&&e.check_out_longitude&&(0,m.jsx)("a",{href:"https://www.google.com/maps?q=".concat(e.check_out_latitude,",").concat(e.check_out_longitude),target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:underline mt-1",onClick:e=>e.stopPropagation(),children:"\ud83d\udccd View"})]})}),(0,m.jsx)("td",{className:"p-4 text-sm font-semibold text-indigo-600 dark:text-indigo-400",children:(0,n.w_)(e.check_in,e.check_out)}),(0,m.jsx)("td",{className:"p-4 text-sm",children:e.overtime_start?(0,m.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,m.jsxs)("span",{className:"text-xs font-medium text-purple-600 dark:text-purple-400",children:["Start: ",(0,n.fU)(e.overtime_start,e.date)]}),e.overtime_end?(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("span",{className:"text-xs font-medium text-orange-600 dark:text-orange-400",children:["End: ",(0,n.fU)(e.overtime_end,e.date)]}),(0,m.jsxs)("span",{className:"text-xs font-bold text-green-600 dark:text-green-400",children:[e.overtime_hours,"h OT"]})]}):(0,m.jsx)("span",{className:"text-xs text-amber-600 dark:text-amber-400",children:"\u23f3 In Progress"})]}):(0,m.jsx)("span",{className:"text-gray-400 text-xs",children:"--"})}),(0,m.jsx)("td",{className:"p-4 text-xs text-gray-600 dark:text-gray-400",children:e.check_in_latitude&&e.check_in_longitude?(0,m.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,m.jsxs)("span",{className:"font-medium",children:["In: ",Number(e.check_in_latitude).toFixed(4),", ",Number(e.check_in_longitude).toFixed(4)]}),e.check_out_latitude&&e.check_out_longitude&&(0,m.jsxs)("span",{className:"font-medium",children:["Out: ",Number(e.check_out_latitude).toFixed(4),", ",Number(e.check_out_longitude).toFixed(4)]})]}):(0,m.jsx)("span",{className:"text-gray-400",children:"--"})}),(0,m.jsx)("td",{className:"p-4 text-xs text-gray-600 dark:text-gray-400",children:e.device_id?(0,m.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,m.jsx)("span",{className:"font-medium",children:e.device_type||"Unknown"}),(0,m.jsxs)("span",{className:"text-gray-500 dark:text-gray-500 truncate max-w-[120px]",title:String(e.device_id),children:["ID: ",String(e.device_id).substring(0,12),"..."]}),e.browser&&(0,m.jsx)("span",{className:"text-gray-500 dark:text-gray-500",children:e.browser})]}):(0,m.jsx)("span",{className:"text-gray-400",children:"--"})}),(0,m.jsx)("td",{className:"p-4 text-sm",children:(0,m.jsx)(j,{variant:e.status,children:e.status})}),(0,m.jsx)("td",{className:"p-4 text-xs text-gray-600 dark:text-gray-400",children:(0,m.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,m.jsxs)("span",{className:"font-medium text-green-600 dark:text-green-400",children:["\u2713 Checked in by ",e.checked_in_by||"self"]}),e.check_out&&(0,m.jsxs)("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:["\u2713 Checked out by ",e.checked_out_by||"self"]}),!e.check_out&&(0,m.jsx)("span",{className:"text-amber-600 dark:text-amber-400",children:"\u23f3 Pending checkout"})]})})]},e.id)):(0,m.jsx)("tr",{children:(0,m.jsx)("td",{colSpan:"9",className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"No attendance records found for this month."})})})]})})})]}),T&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,m.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full",children:[(0,m.jsxs)("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:[(0,m.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"\ud83d\udccd Location Required"}),(0,m.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Confirm your location for attendance tracking"})]}),(0,m.jsxs)("div",{className:"p-5 space-y-4",children:[D&&(0,m.jsxs)("div",{className:"space-y-2",children:[(0,m.jsx)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Your Current Location:"}),(0,m.jsx)("div",{className:"h-48 rounded-lg overflow-hidden border border-gray-300 dark:border-gray-600",children:(0,m.jsxs)(o.W,{center:[D.latitude,D.longitude],zoom:15,style:{height:"100%",width:"100%"},scrollWheelZoom:!1,children:[(0,m.jsx)(c.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,m.jsx)(l.p,{position:[D.latitude,D.longitude],children:(0,m.jsxs)(i.z,{children:["Your Location",(0,m.jsx)("br",{}),"Lat: ",D.latitude.toFixed(6),(0,m.jsx)("br",{}),"Lng: ",D.longitude.toFixed(6)]})})]})}),(0,m.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["\ud83d\udccc ",D.latitude.toFixed(6),", ",D.longitude.toFixed(6)]})]}),(0,m.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:(0,m.jsxs)("p",{className:"text-xs text-blue-800 dark:text-blue-300",children:[(0,m.jsx)("strong",{children:"\u2139\ufe0f Note:"})," Your location is captured only during check-in/check-out for attendance verification."]})})]}),(0,m.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end",children:[(0,m.jsx)(v,{variant:"outline",onClick:()=>{U(!1),M(null),E(null),I(!1),L(!1)},disabled:F||P,children:"Cancel"}),(0,m.jsx)(v,{variant:"check-out"===q?"destructive":"success",onClick:"check-out"===q?async()=>{try{L(!0),U(!1);await d.A.post("/my-attendance/check-out",{check_out_latitude:D.latitude,check_out_longitude:D.longitude});A("Successfully checked out! \ud83d\udc4b"),await te()}catch(N){var e,t,r,a;if(console.error("Checkout error:",N),"checkout_restricted"===(null===(e=N.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error))C(N.response.data.message||"Checkout is not allowed after 9:00 PM. Please contact HR/Admin/SuperAdmin.");else C((null===(r=N.response)||void 0===r||null===(a=r.data)||void 0===a?void 0:a.message)||"Failed to check out. Please try again.")}finally{L(!1),M(null),E(null)}}:async()=>{try{I(!0),C(null),U(!1);const e=ae(),t=(0,a.A)({latitude:D.latitude,longitude:D.longitude,force_checkin:!0},e);await d.A.post("/my-attendance/check-in",t),A("Checked in successfully at your current location!"),await te()}catch(r){var e,t;console.error("Check-in error:",r),C((null===r||void 0===r?void 0:r.message)||(null===r||void 0===r||null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to check in.")}finally{I(!1),M(null),E(null)}},disabled:F||P,children:F||P?"Processing...":"check-out"===q?"Confirm Check Out":"Confirm Check In"})]})]})}),R&&(0,m.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,m.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[(0,m.jsxs)("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:[(0,m.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"\u26a0\ufe0f Pending Check-Outs Detected"}),(0,m.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:["You have ",W.length," session",W.length>1?"s":""," without check-out. Contact HR/Admin for checkout or proceed with new check-in."]})]}),(0,m.jsxs)("div",{className:"p-5",children:[(0,m.jsx)("div",{className:"space-y-3",children:W.map(e=>(0,m.jsx)("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600",children:(0,m.jsxs)("div",{className:"flex justify-between items-start",children:[(0,m.jsxs)("div",{children:[(0,m.jsxs)("div",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:["\ud83d\udcc5 ",new Date(e.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),(0,m.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:["Check-in: ",(0,m.jsx)("span",{className:"font-medium text-green-600 dark:text-green-400",children:e.check_in})]}),e.check_in_latitude&&e.check_in_longitude&&(0,m.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["\ud83d\udccd ",Number(e.check_in_latitude).toFixed(4),", ",Number(e.check_in_longitude).toFixed(4)]})]}),(0,m.jsx)(j,{variant:"warning",children:"Pending"})]})},e.id))}),(0,m.jsx)("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-3 mt-4",children:(0,m.jsxs)("p",{className:"text-xs text-amber-800 dark:text-amber-300",children:[(0,m.jsx)("strong",{children:"\u2139\ufe0f Note:"})," Employees cannot check themselves out. Please contact HR or Admin to complete these checkouts, or proceed with a new check-in. Unchecked sessions will be automatically checked out at midnight."]})})]}),(0,m.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end",children:[(0,m.jsx)(v,{variant:"outline",onClick:()=>{H(!1),G([]),M(null),E(null)},children:"Cancel"}),(0,m.jsx)(v,{variant:"success",onClick:async()=>{try{I(!0),C(null),H(!1);const e=ae(),t=(0,a.A)({latitude:D.latitude,longitude:D.longitude,force_checkin:!0},e);await d.A.post("/my-attendance/check-in",t),A("Checked in successfully! Don't forget to check out your pending sessions."),await te()}catch(r){var e,t;console.error("Force check-in error:",r),C((null===r||void 0===r?void 0:r.message)||(null===r||void 0===r||null===(e=r.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||"Failed to check in.")}finally{I(!1),M(null),E(null),G([])}},children:"Proceed with Check In"})]})]})}),J&&(0,m.jsx)(u.A,{email:null===e||void 0===e?void 0:e.email,onFaceEnrolled:async(e,r)=>{console.log("\u2705 Face enrolled successfully, proceeding with check-in...");try{const a=new FormData;a.append("face_descriptor",JSON.stringify(e)),a.append("face_image",r,"face.jpg");await d.A.post("/auth/enroll-face",a,{headers:{"Content-Type":"multipart/form-data"}});K(!1),Q(!1);const s=localStorage.getItem("token");s&&t&&await t(s),A("Face enrolled successfully! Proceeding with check-in..."),setTimeout(()=>{se()},1e3)}catch(n){var a,s;console.error("Failed to enroll face:",n),C((null===(a=n.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"Failed to enroll face. Please try again."),K(!1)}},onClose:()=>{K(!1),Q(!1),C("Face enrollment is required to check in.")}})]})}}}]);
//# sourceMappingURL=921.efff8b38.chunk.js.map