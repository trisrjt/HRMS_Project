"use strict";(self.webpackChunkfrontend_react=self.webpackChunkfrontend_react||[]).push([[846],{8846:(e,t,a)=>{a.r(t),a.d(t,{default:()=>k});var r=a(9379),o=a(5043),s=a(8163),n=a(1321),l=a(8729),i=a(1291),d=a(9419),c=a(6036),g=a(3318),x=a(2023),u=(a(6433),a(228)),m=a.n(u),h=a(4004),b=a(579);delete m().Icon.Default.prototype._getIconUrl,m().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});const y=e=>{var t,a,r,o,s;let{profile:n}=e;const l=(new Date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return(0,b.jsxs)("div",{className:"bg-gradient-to-r from-indigo-600 to-blue-500 rounded-2xl p-8 text-white mb-8 shadow-lg flex justify-between items-center flex-wrap gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold mb-2",children:["Welcome back, ",(null===n||void 0===n||null===(t=n.name)||void 0===t?void 0:t.split(" ")[0])||"Employee","!"]}),(0,b.jsxs)("div",{className:"flex gap-6 text-sm opacity-90",children:[(0,b.jsxs)("span",{children:["Department: ",(0,b.jsx)("strong",{children:(null===n||void 0===n||null===(a=n.employee)||void 0===a||null===(r=a.department)||void 0===r?void 0:r.name)||"N/A"})]}),(0,b.jsxs)("span",{children:["Designation: ",(0,b.jsx)("strong",{children:(null===n||void 0===n||null===(o=n.employee)||void 0===o||null===(s=o.designation)||void 0===s?void 0:s.name)||"N/A"})]})]})]}),(0,b.jsxs)("div",{className:"text-right bg-white/10 px-5 py-3 rounded-xl backdrop-blur-sm",children:[(0,b.jsx)("div",{className:"text-sm opacity-80 mb-1",children:"Today is"}),(0,b.jsx)("div",{className:"text-lg font-semibold",children:l})]})]})},p=e=>{let{attendance:t,onCheckIn:a,onCheckOut:r,loading:o}=e;const s=!(null===t||void 0===t||!t.check_in),n=!(null===t||void 0===t||!t.check_out),l=(null===t||void 0===t?void 0:t.status)||"Not Marked";return(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200 dark:border-gray-700 mb-8 transition-colors duration-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Today's Attendance"}),(0,b.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat("Present"===l?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"),children:l})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Check In"}),(0,b.jsx)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:null!==t&&void 0!==t&&t.check_in?(0,i.fU)(t.check_in):"--:--"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Check Out"}),(0,b.jsx)("div",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:null!==t&&void 0!==t&&t.check_out?(0,i.fU)(t.check_out):"--:--"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 mb-1",children:"Duration"}),(0,b.jsx)("div",{className:"text-xl font-semibold text-indigo-600 dark:text-indigo-400",children:(0,i.w_)(null===t||void 0===t?void 0:t.check_in,null===t||void 0===t?void 0:t.check_out)})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)("button",{onClick:a,disabled:o||s,className:"py-3.5 rounded-xl font-semibold text-base transition-all duration-200 ".concat(s?"bg-gray-100 text-gray-400 dark:bg-gray-700 dark:text-gray-500 cursor-not-allowed":"bg-emerald-500 hover:bg-emerald-600 text-white shadow-md hover:shadow-lg"),children:s?"Checked In":"Check In"}),(0,b.jsx)("button",{onClick:r,disabled:o||!s||n,className:"py-3.5 rounded-xl font-semibold text-base transition-all duration-200 ".concat(!s||n?"bg-gray-100 text-gray-400 dark:bg-gray-700 dark:text-gray-500 cursor-not-allowed":"bg-rose-500 hover:bg-rose-600 text-white shadow-md hover:shadow-lg"),children:n?"Checked Out":"Check Out"})]})]})},v=e=>{let{leaves:t,announcements:a,payslips:r,navigate:o}=e;return(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200 dark:border-gray-700 transition-colors duration-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Leave Summary"}),(0,b.jsx)("button",{onClick:()=>o("/employee/leaves"),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium text-sm transition-colors",children:"View All"})]}),t.length>0?(0,b.jsx)("div",{className:"flex flex-col gap-4",children:t.map(e=>{var t;return(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b border-gray-100 dark:border-gray-700 last:border-0 last:pb-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:(null===(t=e.leave_type)||void 0===t?void 0:t.name)||"Leave"}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[new Date(e.start_date).toLocaleDateString()," - ",new Date(e.end_date).toLocaleDateString()]})]}),(0,b.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat("Approved"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"Rejected"===e.status?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"),children:e.status})]},e.id)})}):(0,b.jsx)("div",{className:"text-center text-gray-400 py-4",children:"No recent leaves"})]}),(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200 dark:border-gray-700 transition-colors duration-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Announcements"}),(0,b.jsx)("button",{onClick:()=>o("/employee/announcements"),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium text-sm transition-colors",children:"View All"})]}),a.length>0?(0,b.jsx)("div",{className:"flex flex-col gap-4",children:a.map(e=>(0,b.jsxs)("div",{className:"pb-2 border-b border-gray-100 dark:border-gray-700 last:border-0 last:pb-0",children:[(0,b.jsx)("div",{className:"font-medium text-gray-800 dark:text-gray-200 mb-1",children:e.title}),(0,b.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(e.created_at).toLocaleDateString()})]},e.id))}):(0,b.jsx)("div",{className:"text-center text-gray-400 py-4",children:"No announcements"})]}),(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-sm border border-gray-200 dark:border-gray-700 transition-colors duration-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Recent Payslips"}),(0,b.jsx)("button",{onClick:()=>o("/employee/payslips"),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300 font-medium text-sm transition-colors",children:"View All"})]}),r.length>0?(0,b.jsx)("div",{className:"flex flex-col gap-3",children:r.map(e=>(0,b.jsxs)("div",{className:"flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,b.jsx)("div",{children:(0,b.jsxs)("div",{className:"font-semibold text-gray-700 dark:text-gray-200 text-sm",children:[new Date(0,e.month-1).toLocaleString("default",{month:"short"})," ",e.year]})}),(0,b.jsxs)("div",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:["\u20b9",Number(e.net_pay||0).toLocaleString()]})]},e.id))}):(0,b.jsx)("div",{className:"text-center text-gray-400 py-4",children:"No payslips found"})]})]})},k=()=>{const{user:e,refreshUser:t}=(0,l.A)(),a=(0,s.Zp)(),[i,u]=(0,o.useState)({profile:null,attendance:null,announcements:[],leaves:[],payslips:[]}),[m,k]=(0,o.useState)(!0),[f,j]=(0,o.useState)(!1),[w,N]=(0,o.useState)(null),[C,A]=(0,o.useState)(null),[S,_]=(0,o.useState)(!1),[L,I]=(0,o.useState)(null),[D,O]=(0,o.useState)(!1),P="undefined"!==typeof window&&window.isSecureContext,E=async()=>{try{const t=await n.A.get("/user"),a=await n.A.get("/announcements"),r=a.data.data||a.data;let o=[];try{o=(await n.A.get("/my-leaves")).data}catch(w){console.warn("Failed to fetch leaves:",w)}let s=[];try{s=(await n.A.get("/my-payslips")).data}catch(w){var e;403!==(null===(e=w.response)||void 0===e?void 0:e.status)&&console.warn("Failed to fetch payslips:",w)}const l=await n.A.get("/my-attendance"),i=(new Date).toISOString().split("T")[0],d=l.data.data||l.data;let c=null;Array.isArray(d)&&(c=d.find(e=>e.date===i)||null),u({profile:t.data,attendance:c,announcements:Array.isArray(r)?r.slice(0,3):[],leaves:Array.isArray(o)?o.slice(0,5):[],payslips:Array.isArray(s)?s.slice(0,3):[]}),N(null)}catch(t){console.error("Dashboard fetch error:",t),N("Failed to load dashboard. Please try refreshing.")}finally{k(!1)}};(0,o.useEffect)(()=>{E()},[]),(0,o.useEffect)(()=>(document.body.style.overflow=S?"hidden":"unset",()=>{document.body.style.overflow="unset"}),[S]);const F=async e=>{if(console.log("check-in"===e?"\ud83d\udd35 Check-in clicked from dashboard":"\ud83d\udd34 Check-out clicked from dashboard"),"check-out"===e){if((new Date).getHours()>=21)return void alert("Checkout is not allowed after 9:00 PM. Please contact HR/Admin/SuperAdmin for assistance.")}try{I(e),console.log("\ud83d\udccd Requesting location for",e);const t=await new Promise((e,t)=>{var a;if(P){if(console.log("\ud83d\udd0d Checking geolocation support..."),!navigator.geolocation)return console.error("\u274c Geolocation not supported"),void t(new Error("Geolocation is not supported by your browser. Please use a modern browser to check in."));console.log("\u2705 Geolocation supported, requesting permission..."),null!==(a=navigator.permissions)&&void 0!==a&&a.query&&navigator.permissions.query({name:"geolocation"}).then(e=>{console.log("\ud83e\udded Geolocation permission state:",e.state)}).catch(e=>{console.log("\ud83e\udded Geolocation permission query failed:",e)}),navigator.geolocation.getCurrentPosition(t=>{console.log("\u2705 Location obtained:",t.coords);const a={latitude:t.coords.latitude,longitude:t.coords.longitude};A(a),e(a)},e=>{console.error("\u274c Location error:",e.code,e.message);let a="Location access denied. Please allow location access to check in.";e.code===e.PERMISSION_DENIED?a="Location permission denied. You must allow location access to check in/out.":e.code===e.POSITION_UNAVAILABLE?a="Location information unavailable. Please try again.":e.code===e.TIMEOUT&&(a="Location request timed out. Please try again."),t(new Error(a))},{timeout:15e3,enableHighAccuracy:!0,maximumAge:0})}else t(new Error("Location requires a secure context. Open the app on http://localhost:3000 (or use HTTPS)."))});console.log("\u2705 Location received, showing modal:",t),_(!0)}catch(t){console.error("\u274c Location error:",t),alert("Location Error: "+((null===t||void 0===t?void 0:t.message)||"Please enable location access in browser settings")),I(null)}};return m?(0,b.jsx)("div",{className:"flex justify-center items-center h-screen text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-900 transition-colors",children:(0,b.jsx)("div",{className:"text-xl font-medium animate-pulse",children:"Loading Dashboard..."})}):!i.profile&&w?(0,b.jsxs)("div",{className:"flex flex-col justify-center items-center h-screen text-red-500 dark:text-red-400 bg-gray-50 dark:bg-gray-900 transition-colors",children:[(0,b.jsx)("div",{className:"mb-4",children:w}),(0,b.jsx)("button",{onClick:E,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Retry"})]}):(0,b.jsxs)("div",{className:"p-8 max-w-[1400px] mx-auto bg-gray-50 dark:bg-gray-900 min-h-screen transition-colors duration-200",children:[e&&!e.face_descriptor&&(0,b.jsx)("div",{className:"fixed top-20 right-8 z-50",children:(0,b.jsx)("button",{onClick:()=>O(!0),className:"px-7 py-4 bg-teal-600 hover:bg-teal-700 text-white rounded-lg font-bold text-md transition-all duration-200 shadow-lg hover:shadow-xl flex items-center gap-2",children:"Enroll Face"})}),(0,b.jsx)(y,{profile:i.profile}),(0,b.jsx)(p,{attendance:i.attendance,onCheckIn:()=>F("check-in"),onCheckOut:()=>F("check-out"),loading:f}),(0,b.jsx)(v,{leaves:i.leaves,announcements:i.announcements,payslips:i.payslips,navigate:a}),S&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full",children:[(0,b.jsxs)("div",{className:"p-5 border-b border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"\ud83d\udccd Location Required"}),(0,b.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:"Confirm your location for attendance tracking"})]}),(0,b.jsxs)("div",{className:"p-5 space-y-4",children:[C&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Your Current Location:"}),(0,b.jsx)("div",{className:"h-48 rounded-lg overflow-hidden border border-gray-300 dark:border-gray-600",children:(0,b.jsxs)(d.W,{center:[C.latitude,C.longitude],zoom:15,style:{height:"100%",width:"100%"},scrollWheelZoom:!1,children:[(0,b.jsx)(x.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,b.jsx)(c.p,{position:[C.latitude,C.longitude],children:(0,b.jsxs)(g.z,{children:["Your Location",(0,b.jsx)("br",{}),"Lat: ",C.latitude.toFixed(6),(0,b.jsx)("br",{}),"Lng: ",C.longitude.toFixed(6)]})})]})}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["\ud83d\udccc ",C.latitude.toFixed(6),", ",C.longitude.toFixed(6)]})]}),(0,b.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-3",children:(0,b.jsxs)("p",{className:"text-xs text-blue-800 dark:text-blue-300",children:[(0,b.jsx)("strong",{children:"\u2139\ufe0f Note:"})," Your location is captured only during check-in/check-out for attendance verification."]})})]}),(0,b.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end",children:[(0,b.jsx)("button",{onClick:()=>{_(!1),I(null),A(null),j(!1)},disabled:f,className:"px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 bg-transparent border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Cancel"}),(0,b.jsx)("button",{onClick:async()=>{try{j(!0),_(!1);const e=(()=>{const e=navigator.userAgent;let t="Desktop";/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?t="Tablet":/Mobile|Android|iP(hone|od)|IEMobile|BlackBerry|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)&&(t="Mobile");let a="Unknown";e.indexOf("Firefox")>-1?a="Firefox":e.indexOf("Chrome")>-1?a="Chrome":e.indexOf("Safari")>-1?a="Safari":e.indexOf("Edge")>-1?a="Edge":(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1)&&(a="IE");let r=localStorage.getItem("device_id");return r||(r="device_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),localStorage.setItem("device_id",r)),{device_id:r,device_type:t,browser:a}})();let t,a;"check-in"===L?(t=(0,r.A)({latitude:C.latitude,longitude:C.longitude,force_checkin:!0},e),a="/my-attendance/check-in"):(t={check_out_latitude:C.latitude,check_out_longitude:C.longitude},a="/my-attendance/check-out"),await n.A.post(a,t),await E(),alert("".concat("check-in"===L?"Checked in":"Checked out"," successfully at your current location!"))}catch(s){var e,t,a,o;if(console.error("".concat(L," error:"),s),"checkout_restricted"===(null===(e=s.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.error))alert(s.response.data.message||"Checkout is not allowed after 9:00 PM. Please contact HR/Admin/SuperAdmin.");else alert((null===s||void 0===s||null===(a=s.response)||void 0===a||null===(o=a.data)||void 0===o?void 0:o.message)||"Failed to ".concat(L))}finally{j(!1),I(null),A(null)}},disabled:f,className:"px-4 py-2 rounded-lg font-medium text-sm transition-all duration-200 ".concat("check-in"===L?"bg-emerald-600 hover:bg-emerald-700":"bg-rose-600 hover:bg-rose-700"," text-white shadow-md hover:shadow-lg disabled:opacity-50"),children:f?"Processing...":"Confirm ".concat("check-in"===L?"Check In":"Check Out")})]})]})}),D&&(0,b.jsx)(h.A,{onFaceEnrolled:async(e,a)=>{try{const r=new FormData;r.append("face_descriptor",JSON.stringify(e)),r.append("face_image",a,"face.jpg"),await n.A.post("/auth/enroll-face",r,{headers:{"Content-Type":"multipart/form-data"}}),O(!1);const o=localStorage.getItem("token");o&&t&&await t(o),alert("Face enrolled successfully! You can now use Quick Check-In on the login page.")}catch(s){var r,o;console.error("Failed to enroll face:",s),alert((null===(r=s.response)||void 0===r||null===(o=r.data)||void 0===o?void 0:o.message)||"Failed to enroll face. Please try again."),O(!1)}},onClose:()=>O(!1)})]})}}}]);
//# sourceMappingURL=846.cd435108.chunk.js.map